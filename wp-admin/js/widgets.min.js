var wpWidgets;!function(e){function t(e){if(e.hasClass("expanded")){e.attr("style")&&e.data("original-style",e.attr("style"));var t=e.width();if(400>t){var i=400-t;isRtl?e.css("position","relative").css("right","-"+i+"px").css("width","400px"):e.css("position","relative").css("left","-"+i+"px").css("width","400px")}}else e.data("original-style")?e.attr("style",e.data("original-style")).data("original-style",null):e.removeAttr("style")}var i=e(document);wpWidgets={init:function(){var t,s,d=this,n=e(".widgets-chooser"),a=n.find(".widgets-chooser-sidebars"),o=e("div.widgets-sortables"),l=!("undefined"==typeof isRtl||!isRtl);e("#widgets-right .sidebar-name").click(function(){var t=e(this),s=t.closest(".widgets-holder-wrap");s.hasClass("closed")?(s.removeClass("closed"),t.parent().sortable("refresh")):s.addClass("closed"),i.triggerHandler("wp-pin-menu")}),e("#widgets-left .sidebar-name").click(function(){e(this).closest(".widgets-holder-wrap").toggleClass("closed"),i.triggerHandler("wp-pin-menu")}),e(document.body).bind("click.widgets-toggle",function(t){var i,s,d,n,a,o=e(t.target),r={"z-index":100};o.parents(".widget-top").length&&!o.parents("#available-widgets").length?(i=o.closest("div.widget"),s=i.children(".widget-inside"),d=parseInt(i.find("input.widget-width").val(),10),n=i.parent().width(),s.is(":hidden")?(d>250&&d+30>n&&i.closest("div.widgets-sortables").length&&(a=i.closest("div.widget-liquid-right").length?l?"margin-right":"margin-left":l?"margin-left":"margin-right",r[a]=n-(d+30)+"px",i.css(r)),i.addClass("open"),s.slideDown("fast")):s.slideUp("fast",function(){i.attr("style",""),i.removeClass("open")}),t.preventDefault()):o.hasClass("widget-control-save")?(wpWidgets.save(o.closest("div.widget"),0,1,0),t.preventDefault()):o.hasClass("widget-control-remove")?(wpWidgets.save(o.closest("div.widget"),1,1,0),t.preventDefault()):o.hasClass("widget-control-close")&&(i=o.closest("div.widget"),i.removeClass("open"),wpWidgets.close(i),t.preventDefault())}),o.children(".widget").each(function(){var t=e(this);wpWidgets.appendTitle(this),t.find("p.widget-error").length&&t.find("a.widget-action").trigger("click")}),e("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:100,containment:"#wpwrap",start:function(t,i){var n=e(this).find(".widgets-chooser");i.helper.find("div.widget-description").hide(),s=this.id,n.length&&(e("#wpbody-content").append(n.hide()),i.helper.find(".widgets-chooser").remove(),d.clearWidgetSelection())},stop:function(){t&&e(t).hide(),t=""}}),o.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"#wpwrap",start:function(t,i){var s,d=e(this),n=d.parent(),a=i.item.children(".widget-inside");"block"===a.css("display")&&(a.hide(),e(this).sortable("refreshPositions")),n.hasClass("closed")||(s=i.item.hasClass("ui-draggable")?d.height():1+d.height(),d.css("min-height",s+"px"))},stop:function(d,n){var a,o,l,r,c,g,h=n.item,p=s;return h.hasClass("deleting")?(wpWidgets.save(h,1,0,1),void h.remove()):(a=h.find("input.add_new").val(),o=h.find("input.multi_number").val(),h.attr("style","").removeClass("ui-draggable"),s="",a&&("multi"===a?(h.html(h.html().replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,o)})),h.attr("id",p.replace("__i__",o)),o++,e("div#"+p).find("input.multi_number").val(o)):"single"===a&&(h.attr("id","new-"+p),t="div#"+p),wpWidgets.save(h,0,0,1),h.find("input.add_new").val(""),i.trigger("widget-added",[h])),l=h.parent(),l.parent().hasClass("closed")&&(l.parent().removeClass("closed"),r=l.children(".widget"),r.length>1&&(c=r.get(0),g=h.get(0),c.id&&g.id&&c.id!==g.id&&e(c).before(h))),void(a?h.find("a.widget-action").trigger("click"):wpWidgets.saveOrder(l.attr("id"))))},activate:function(){e(this).parent().addClass("widget-hover")},deactivate:function(){e(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(t,i){var s=e(i.sender);return this.id.indexOf("orphaned_widgets")>-1?void s.sortable("cancel"):void(s.attr("id").indexOf("orphaned_widgets")>-1&&!s.children(".widget").length&&s.parents(".orphan-sidebar").slideUp(400,function(){e(this).remove()}))}}).sortable("option","connectWith","div.widgets-sortables"),e("#available-widgets").droppable({tolerance:"pointer",accept:function(t){return"widget-list"!==e(t).parent().attr("id")},drop:function(t,i){i.draggable.addClass("deleting"),e("#removing-widget").hide().children("span").empty()},over:function(t,i){i.draggable.addClass("deleting"),e("div.widget-placeholder").hide(),i.draggable.hasClass("ui-sortable-helper")&&e("#removing-widget").show().children("span").html(i.draggable.find("div.widget-title").children("h4").html())},out:function(t,i){i.draggable.removeClass("deleting"),e("div.widget-placeholder").show(),e("#removing-widget").hide().children("span").empty()}}),e("#widgets-right .widgets-holder-wrap").each(function(t,i){var s=e(i),d=s.find(".sidebar-name h3").text(),n=s.find(".widgets-sortables").attr("id"),o=e('<li tabindex="0">').text(e.trim(d));0===t&&o.addClass("widgets-chooser-selected"),a.append(o),o.data("sidebarId",n)}),e("#available-widgets .widget .widget-title").on("click.widgets-chooser",function(){var t=e(this).closest(".widget");t.hasClass("widget-in-question")||e("#widgets-left").hasClass("chooser")?d.closeChooser():(d.clearWidgetSelection(),e("#widgets-left").addClass("chooser"),t.addClass("widget-in-question").children(".widget-description").after(n),n.slideDown(300,function(){a.find(".widgets-chooser-selected").focus()}),a.find("li").on("focusin.widgets-chooser",function(){a.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected"),e(this).addClass("widgets-chooser-selected")}))}),n.on("click.widgets-chooser",function(t){var i=e(t.target);i.hasClass("button-primary")?(d.addWidget(n),d.closeChooser()):i.hasClass("button-secondary")&&d.closeChooser()}).on("keyup.widgets-chooser",function(t){t.which===e.ui.keyCode.ENTER?e(t.target).hasClass("button-secondary")?d.closeChooser():(d.addWidget(n),d.closeChooser()):t.which===e.ui.keyCode.ESCAPE&&d.closeChooser()})},saveOrder:function(t){var i={action:"widgets-order",savewidgets:e("#_wpnonce_widgets").val(),sidebars:[]};t&&e("#"+t).find(".spinner:first").addClass("is-active"),e("div.widgets-sortables").each(function(){e(this).sortable&&(i["sidebars["+e(this).attr("id")+"]"]=e(this).sortable("toArray").join(","))}),e.post(ajaxurl,i,function(){e(".spinner").removeClass("is-active")})},save:function(t,s,d,n){var a,o=t.closest("div.widgets-sortables").attr("id"),l=t.find("form").serialize();t=e(t),e(".spinner",t).addClass("is-active"),a={action:"save-widget",savewidgets:e("#_wpnonce_widgets").val(),sidebar:o},s&&(a.delete_widget=1),l+="&"+e.param(a),e.post(ajaxurl,l,function(a){var o;s?(e("input.widget_number",t).val()||(o=e("input.widget-id",t).val(),e("#available-widgets").find("input.widget-id").each(function(){e(this).val()===o&&e(this).closest("div.widget").show()})),d?(n=0,t.slideUp("fast",function(){e(this).remove(),wpWidgets.saveOrder()})):t.remove()):(e(".spinner").removeClass("is-active"),a&&a.length>2&&(e("div.widget-content",t).html(a),wpWidgets.appendTitle(t),i.trigger("widget-updated",[t]))),n&&wpWidgets.saveOrder()})},appendTitle:function(t){var i=e('input[id*="-title"]',t).val()||"";i&&(i=": "+i.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;")),e(t).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(i)},close:function(e){e.children(".widget-inside").slideUp("fast",function(){e.attr("style","")})},addWidget:function(t){var s,d,n,a,o,l,r,c=t.find(".widgets-chooser-selected").data("sidebarId"),g=e("#"+c);s=e("#available-widgets").find(".widget-in-question").clone(),d=s.attr("id"),n=s.find("input.add_new").val(),a=s.find("input.multi_number").val(),s.find(".widgets-chooser").remove(),"multi"===n?(s.html(s.html().replace(/<[^<>]+>/g,function(e){return e.replace(/__i__|%i%/g,a)})),s.attr("id",d.replace("__i__",a)),a++,e("#"+d).find("input.multi_number").val(a)):"single"===n&&(s.attr("id","new-"+d),e("#"+d).hide()),g.closest(".widgets-holder-wrap").removeClass("closed"),g.append(s),g.sortable("refresh"),wpWidgets.save(s,0,0,1),s.find("input.add_new").val(""),i.trigger("widget-added",[s]),o=e(window).scrollTop(),l=o+e(window).height(),r=g.offset(),r.bottom=r.top+g.outerHeight(),(o>r.bottom||l<r.top)&&e("html, body").animate({scrollTop:r.top-130},200),window.setTimeout(function(){s.find(".widget-title").trigger("click")},250)},closeChooser:function(){var t=this;e(".widgets-chooser").slideUp(200,function(){e("#wpbody-content").append(this),t.clearWidgetSelection()})},clearWidgetSelection:function(){e("#widgets-left").removeClass("chooser"),e(".widget-in-question").removeClass("widget-in-question")}},i.ready(function(){wpWidgets.init()}),wpBannerWidget={uploader:function(e,t){var i=wp.media({title:"Select an Image",multiple:!1,library:{type:"image"},button:{text:"Insert Into Widget"}});return i.on("close",function(){var s=i.state().get("selection").toJSON();wpBannerWidget.render(e,t,s[0])}),i.open(),!1},render:function(t,i,s){null!=s&&(e("#"+i+"preview").html(wpBannerWidget.imgHTML(s)),e("#"+i+"fields").slideDown(),e("#"+i+"attachment_id").val(s.id),e("#"+i+"imageurl").val(s.url),e("#"+i+"aspect_ratio").val(s.width/s.height),e("#"+i+"width").val(s.width),e("#"+i+"height").val(s.height),e("#"+i+"size").val("full"),e("#"+i+"custom_size_selector").slideDown(),wpBannerWidget.toggleSizes(t,i),wpBannerWidget.updateInputIfEmpty(i,"title",s.title),wpBannerWidget.updateInputIfEmpty(i,"alt",s.alt),wpBannerWidget.updateInputIfEmpty(i,"description",s.description),wpBannerWidget.updateInputIfEmpty(i,"description",s.caption))},updateInputIfEmpty:function(t,i,s){var d=e("#"+t+i);""==d.val()&&d.val(s)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',""!=e.alt&&(t+='alt="'+e.alt+'" '),t+="/>"},toggleSizes:function(t,i){"tribe_image_widget_custom"==e("#"+i+"size").val()?e("#"+i+"custom_size_fields").slideDown():e("#"+i+"custom_size_fields").slideUp()},changeImgWidth:function(t,i){var s=e("#"+i+"aspect_ratio").val();if(s){var d=e("#"+i+"width").val(),n=Math.round(d/s);e("#"+i+"height").val(n)}},changeImgHeight:function(t,i){var s=e("#"+i+"aspect_ratio").val();if(s){var d=e("#"+i+"height").val(),n=Math.round(d*s);e("#"+i+"width").val(n)}}};var s=e("div#widgets-right");e("a.display-options").each(function(){var t=e(this),i=t.closest("div.widget");t.insertBefore(i.find("input.widget-control-save")),t.parent().removeClass("widget-control-noform").find(".spinner").remove().css("float","left").prependTo(t.parent())}),s.on("click.widgetconditions","a.add-condition",function(t){t.preventDefault();var i=e(this).closest("div.condition"),s=i.clone().insertAfter(i);s.find("select.conditions-rule-major").val(""),s.find("select.conditions-rule-minor").html("").attr("disabled")}),s.on("click.widgetconditions","a.display-options",function(i){i.preventDefault();var s=e(this),d=s.closest("div.widget");d.find("div.widget-conditional").toggleClass("widget-conditional-hide"),e(this).toggleClass("active"),d.toggleClass("expanded"),t(d),d.find("input[name=widget-conditions-visible]").val(e(this).hasClass("active")?"1":"0")}),s.on("click.widgetconditions","a.delete-condition",function(t){t.preventDefault();var i=e(this).closest("div.condition");i.is(":first-child")&&i.is(":last-child")?(e(this).closest("div.widget").find("a.display-options").click(),i.find("select.conditions-rule-major").val("").change()):i.detach()}),s.on("click.widgetconditions","div.widget-top",function(){var i=e(this).closest("div.widget"),s=i.find("a.display-options");s.hasClass("active")&&s.attr("opened","true"),s.attr("opened")&&(s.removeAttr("opened"),i.toggleClass("expanded"),t(i))}),e(document).on("change.widgetconditions","select.conditions-rule-major",function(){var t=e(this),i=t.siblings("select.conditions-rule-minor:first");if(t.val()){i.html("").append(e("<option/>").text(i.data("loading-text")));var s={action:"widget_conditions_options",major:t.val()};jQuery.post(ajaxurl,s,function(e){i.html(e).removeAttr("disabled")})}else t.siblings("select.conditions-rule-minor").attr("disabled","disabled").html("")})}(jQuery);